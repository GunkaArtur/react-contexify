'use strict';

var H = require('react');
var X = require('clsx');
var reactDom = require('react-dom');

var Y=H.createContext({}),F=()=>H.useContext(Y),$=t=>H.createElement(Y.Provider,{...t});function le(){let t=new Map;return {on(e,r){return t.has(e)?t.get(e).add(r):t.set(e,new Set([r])),this},off(e,r){return t.has(e)&&t.get(e).delete(r),this},emit(e,r){return t.has(e)&&t.get(e).forEach(l=>{l(r);}),this}}}var R=le();var B=()=>H.useRef(new Map).current;var z=()=>{},W=["resize","contextmenu","click","scroll","blur"];var A={show({event:t,id:e,props:r,position:l}){t.preventDefault&&t.preventDefault(),R.emit(0).emit(e,{event:t.nativeEvent||t,props:r,position:l});},hideAll(){R.emit(0);}};function Fe(t){return {show(e){A.show({...t,...e});},hideAll(){A.hideAll();}}}function G(){let t=new Map,e,r,l,s,i=!1;function P(n){s=Array.from(n.values()),e=-1,l=!0;}function v(){s[e].node.focus();}let b=()=>e>=0&&s[e].isSubmenu,w=()=>Array.from(s[e].submenuRefTracker.values());function d(){return e===-1?(x(),!1):!0}function x(){e+1<s.length?e++:e+1===s.length&&(e=0),i&&a(),v();}function E(){e===-1||e===0?e=s.length-1:e-1<s.length&&e--,i&&a(),v();}function T(){if(d()&&b()){let n=w(),{node:u,setSubmenuPosition:h}=s[e];return t.set(u,{isRoot:l,focusedIndex:e,parentNode:r||u,items:s}),h(),u.classList.add("contexify_submenu-isOpen"),r=u,n.length>0?(e=0,s=n):i=!0,l=!1,v(),!0}return !1}function a(){if(d()&&!l){let n=t.get(r);r.classList.remove("contexify_submenu-isOpen"),s=n.items,r=n.parentNode,n.isRoot&&(l=!0,t.clear()),i||(e=n.focusedIndex,v());}}function M(n){function u(h){for(let o of h)o.isSubmenu&&o.submenuRefTracker&&u(Array.from(o.submenuRefTracker.values())),o.keyMatcher&&o.keyMatcher(n);}u(s);}return {init:P,moveDown:x,moveUp:E,openSubmenu:T,closeSubmenu:a,matchKeys:M}}function I(t){return typeof t=="function"}function U(t){return typeof t=="string"}function _(t,e){return H.Children.map(H.Children.toArray(t).filter(Boolean),r=>H.cloneElement(r,e))}function J(t){let e={x:t.clientX,y:t.clientY},r=t.changedTouches;return r&&(e.x=r[0].clientX,e.y=r[0].clientY),(!e.x||e.x<0)&&(e.x=0),(!e.y||e.y<0)&&(e.y=0),e}function k(t,e){return I(t)?t(e):t}function xe(t,e){return {...t,...I(e)?e(t):e}}var it=({id:t,theme:e,style:r,className:l,children:s,animation:i="fade",preventDefaultOnKeydown:P=!0,disableBoundariesCheck:v=!1,onVisibilityChange:b,...w})=>{let[d,x]=H.useReducer(xe,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),E=H.useRef(null),T=B(),[a]=H.useState(()=>G()),M=H.useRef(),n=H.useRef();H.useEffect(()=>(R.on(t,h).on(0,o),()=>{R.off(t,h).off(0,o);}),[t,i,v]),H.useEffect(()=>{d.visible?a.init(T):T.clear();},[d.visible,a,T]);function u(c,p){if(E.current&&!v){let{innerWidth:f,innerHeight:C}=window,{offsetWidth:K,offsetHeight:O}=E.current;c+K>f&&(c-=c+K-f),p+O>C&&(p-=p+O-C);}return {x:c,y:p}}console.log("works"),H.useEffect(()=>{function c(f){P&&f.preventDefault();}function p(f){switch(f.key){case"Enter":case" ":a.openSubmenu()||o();break;case"Escape":o();break;case"ArrowUp":c(f),a.moveUp();break;case"ArrowDown":c(f),a.moveDown();break;case"ArrowRight":c(f),a.openSubmenu();break;case"ArrowLeft":c(f),a.closeSubmenu();break;default:a.matchKeys(f);break}}if(d.visible){window.addEventListener("keydown",p);for(let f of W)window.addEventListener(f,o);}return ()=>{window.removeEventListener("keydown",p);for(let f of W)window.removeEventListener(f,o);}},[d.visible,a,P]);function h({event:c,props:p,position:f}){c.stopPropagation();let C=f||J(c),{x:K,y:O}=u(C.x,C.y);reactDom.flushSync(()=>{x({visible:!0,willLeave:!1,x:K,y:O,triggerEvent:c,propsFromTrigger:p});}),clearTimeout(n.current),!M.current&&I(b)&&(b(!0),M.current=!0);}function o(c){c!=null&&(c.button===2||c.ctrlKey)&&c.type!=="contextmenu"||(i&&(U(i)||"exit"in i&&i.exit)?x(p=>({willLeave:p.visible})):x(p=>({visible:p.visible?!1:p.visible})),n.current=setTimeout(()=>{I(b)&&b(!1),M.current=!1;}));}function y(){d.willLeave&&d.visible&&reactDom.flushSync(()=>x({visible:!1,willLeave:!1}));}function S(){return U(i)?X.clsx({[`${"contexify_willEnter-"}${i}`]:g&&!D,[`${"contexify_willLeave-"}${i} ${"contexify_willLeave-"}'disabled'`]:g&&D}):i&&"enter"in i&&"exit"in i?X.clsx({[`${"contexify_willEnter-"}${i.enter}`]:i.enter&&g&&!D,[`${"contexify_willLeave-"}${i.exit} ${"contexify_willLeave-"}'disabled'`]:i.exit&&g&&D}):null}let{visible:g,triggerEvent:m,propsFromTrigger:L,x:oe,y:ie,willLeave:D}=d,ae=X.clsx("contexify",l,{[`${"contexify_theme-"}${e}`]:e},S());return H.createElement($,{value:T},g&&H.createElement("div",{...w,className:ae,onAnimationEnd:y,style:{...r,left:oe,top:ie,opacity:1},ref:E,role:"menu"},_(s,{propsFromTrigger:L,triggerEvent:m})))};var pt=({id:t,children:e,className:r,style:l,triggerEvent:s,data:i,propsFromTrigger:P,keyMatcher:v,onClick:b=z,disabled:w=!1,hidden:d=!1,closeOnClick:x=!0,handlerEvent:E="onClick",...T})=>{let a=H.useRef(),M=F(),n={id:t,data:i,triggerEvent:s,props:P},u=k(w,n),h=k(d,n);function o(m){n.event=m,m.stopPropagation(),u||(x?y():b(n));}function y(){let m=a.current;m.focus(),m.addEventListener("animationend",()=>setTimeout(A.hideAll),{once:!0}),m.classList.add("contexify_item-feedback"),b(n);}function S(m){m&&!u&&(a.current=m,M.set(m,{node:m,isSubmenu:!1,keyMatcher:!u&&I(v)&&(L=>{v(L)&&(L.stopPropagation(),L.preventDefault(),n.event=L,y());})}));}function g(m){(m.key==="Enter"||m.key===" ")&&(m.stopPropagation(),n.event=m,y());}return h?null:H.createElement("div",{...T,[E]:o,className:X.clsx("contexify_item",r,{[`${"contexify_item-disabled"}`]:u}),style:l,onKeyDown:g,ref:S,tabIndex:-1,role:"menuitem","aria-disabled":u},H.createElement("div",{className:"contexify_itemContent"},e))};var Et=({triggerEvent:t,data:e,propsFromTrigger:r,hidden:l=!1})=>k(l,{data:e,triggerEvent:t,props:r})?null:H.createElement("div",{className:"contexify_separator"});var re=()=>H.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},H.createElement("polyline",{points:"9 18 15 12 9 6"}));var ne=({className:t,...e})=>H.createElement("div",{className:X.clsx("contexify_rightSlot",t),...e});var Kt=({arrow:t,children:e,disabled:r=!1,hidden:l=!1,label:s,className:i,triggerEvent:P,propsFromTrigger:v,style:b,...w})=>{let d=F(),x=B(),E=H.useRef(null),T={triggerEvent:P,props:v},a=k(r,T),M=k(l,T);function n(){let o=E.current;if(o){let y=`${"contexify_submenu"}-bottom`,S=`${"contexify_submenu"}-right`;o.classList.remove(y,S);let g=o.getBoundingClientRect();g.right>window.innerWidth&&o.classList.add(S),g.bottom>window.innerHeight&&o.classList.add(y);}}function u(o){o&&!a&&d.set(o,{node:o,isSubmenu:!0,submenuRefTracker:x,setSubmenuPosition:n});}if(M)return null;let h=X.clsx("contexify_item",i,{[`${"contexify_item-disabled"}`]:a});return H.createElement($,{value:x},H.createElement("div",{...w,className:h,ref:u,tabIndex:-1,role:"menuitem","aria-haspopup":!0,"aria-disabled":a,onMouseEnter:n,onTouchStart:n},H.createElement("div",{className:"contexify_itemContent",onClick:o=>o.stopPropagation()},s,H.createElement(ne,null,t||H.createElement(re,null))),H.createElement("div",{className:`${"contexify"} ${"contexify_submenu"}`,ref:E,style:b},_(e,{propsFromTrigger:v,triggerEvent:P}))))};

exports.Item = pt;
exports.Menu = it;
exports.RightSlot = ne;
exports.Separator = Et;
exports.Submenu = Kt;
exports.contextMenu = A;
exports.useContextMenu = Fe;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map